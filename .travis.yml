language: ruby
sudo: false
addons:
  apt:
    packages:
      - libcurl4-openssl-dev
      - make

env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
  - secure: uJNqLIq1fdngurslMfUaSWdSiZZwAJkiwOsRcXdNRf+kMj4FP4iyAdz0/bWbn5p03skZrLJJKg41kDYl/3WDtCqIw51RyPY/B1lglotYLrT1dv1KgaLr9DB92r/9B+k49xeEwgi0oJfThxRAUi/QmTiyyqDPufbmbMDpyJMOnQVPE+oXEshUGtYI001DJUPKc+n3buyAkrpE180HBl5AlW1YZ4pY0wak4qBpPBTiFBlF9r9UqTRm3KzIuSsJpu2R8Jgn7QbU1RUf7DVtyFctzzxy4C5iA+lfOrbI+73ORliaTkAv8a05EzPpTOsL+TuM9yu0yUpjEZbuLlF/cd7vRK9aBSn4oJlZUbkwGVAl2BNjTt/2d68zmaERlEg4ry9uuAl9J4i+E6TY+gb+//vHun5f8yctpTiUhQYU6Utk3iWJhnQLOech01OtpvK8obbQBK6BwBvPGWgNvrZP3yseSkON2VqUsRCR8HI8sbi8/uMqF8vG+s0J4G6uxxYmUE43UM7aDPBi3UlaB6oWJstA/rLK71oU/iCsujkbW68dcLhOf86QN0Tf2DjDOetJs8Al0qiJh8xgpUimTw4U/1ewtLLgwbbImwi0DJBp/JturKXuGdU5Kvnh5uqveBFzFRKxnsKOmMkrho+JbIGnOMw8BIhY1DL29XJxIMKOkwSQNJQ=
  - secure: xVjmpJtS902gfUrekJ6OwEfaw78Ho9/amNBbO4z4uzq4jOWSqUV4MN+EoR1YBcBXSmZ1ritPcv93gGMpJpgiA06xa9+PYRMJE7W0Bj7neWo8S5d4NsGi3+oq9XIt2sV/o4qXv/s/g4NqBm6ZVv2i0r5CIKGl/WqUwH3lBA/aoE1/nBtxBmrT7XfJY8I7kbDD19H6Spj22O/ZcBlEZM1ExwulAyaucqmJbtiy+7JZWeiVJkwXxjkpl0AEwFTUOeGyua/yWy4YoTFjCMfmE3LiijkaGZ5ol0BlZakShUr9M54ZsM/fER4zyWwW7TKNesP3v3MJAKsbOOfAaM456MJjbnPJJR1AgBK8QObKC6xlioShDaUHzhlfxwE+Ut7SosRXQ7hkwXBZmiUTwNwrdIqU4ka9yjK9sFqBL3uxkQmWm7MxWroD8iwXAQdiMiYcrlKAPGIhEeAbObPhGHXNh4eAztydtAoEFZpzT90crD3Ble4Y6Jv8Eh/tocK5nP9/sZJXnl0rVrOALrrlCBaTmjpaosaUWIUnGvXuVA/eujKRsDVY6z13a6IXp07LYuEDeztGu4xoIt8GKet6UgnBagLQzNpH453TK5SFw5AfPW6fJPwxH4NkatGq94hhA/qIl5uR53FdeBI5oEUmV7q24l7cWcQKQY84AOjCKUSZbWJnfi4=
  - secure: JoJAbM8Y017+z1LGAu6yw1dV9xqKbrLFZHcJVxkyW4/YTFogoP8PEJZSpPijCqEdNUw24m9tBF5Ut8mBcGsL76VW0oH92f3iIIEQ7Vjco0P2Azh2vJ6rZjS3WNqEqxPNeE9uLOWC9w9EiAMGz86SiKici6wAZGVNS7TcVg694+CphDaG8FI3p502MNaA9cjIHQX8QcDIRJlYXB2nqO4tD3ARrUo+kCViA//K/ct48aagNY8xvAoPRaeDCPJGaqNSBronbLssS6R+LmimHA9Bhz3q1tndVLLoMTNuFC9vXi5ufFbMH7uQv2cF+jEjQUb/fiKTJsZGzVFHZ+k6Mimk+jaYFZTJd0iTkxTJfc38mhGeUbReJac619h/tCMuVTjRb/i2mFVRS12F9Q309+Br81R7Wm6VKCnf+RYhqJ2R+Ljrn9EGOffkliVwLZPTtFPjBJCJrORsO3bhFqlZjX6ZLRzAcYQL/5whEecDL0boV/b5BwJuUtSk6FlvE+arw6pdXDOMmMn3F4WMsrSfpRgKoUcWAg7e0AcgSnEtnmMXuVaitfUKArPsCwzVhMZlPafAa04Iapjc6eUGUBkiyf4yKsgYbYKuZM7Xi4pHEJRhTRo+OLexID+999CnnlPD8kDiZMDX0mTAkeTT0dlD0yYpOMl7qv9IC12PwI4MlxAMpQs=
  - secure: hrCSzoi0OrwWFDJZIicpCONCkRqgeL7Eo5fPKKsVxlwTQjjRq+qnOEtu5+EBtymqkT5cjvIwDuwT6wmbB3hRn0I28NzGx16iDyLCp8UHn6VJe/q6I5lwSGhjt0Mub/oEmCKBIWjaEdNls/hgS3oIZaFeErQt7B3coqiLWmyM0NLXiV0fsAajl1Ih3HByYwCqZzXzrAWo1rdf8BM/yrQhVrUDmJXX9AN7JItS4So15k8jaJRhrbZ7Xb78NZDGVF1CaJKsp0vaUZcFPjIP+tgamxDBdpQs/f6o4eZmYDJ12jpXnCCFpuWyVOsNkDart+qpsrqci7dbz2i9MfwazMlx5PPWdCPOc9Ga4wMbMR0WV/8GKn4hxOQFIEADsKvUL0ihcblUnf/CAyTvGWKM+Oq2Ze4FbvUcGow+Pj56C2TPStpCw/VuaysUV5RWqBXArmSLUV2eObrD7yK7rdKFqY5i9AFkKQh1qrAV/Rv+4MDO0MSMn3BGnZL6ArTUVg4XITaXJI+nMYvf37WCVgVU6VytEHdp1Eo4vWAueREV2VoOZR1zMTv4EFgkHboN1xI+DFAipDaStU00KjF3MQeFymFwjEnyKT54BBJjELH2vciRSIBkeRBtGuIUQdrVD05SNejxP9Q9rtcBmpW2h3N1qAJv2hZv9jBheSsHrLA1g8P64wk=

cache: bundler

rvm:
  - 2.6.3

before_install:
  - gem update --system -f
  - gem install bundler

install: bundle install --without :development

before_script:
 - chmod +x ./scripts/build_travis.sh
script: scripts/build_travis.sh

before_deploy:
- echo -e "Host $DEPLOY_HOST\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- openssl aes-256-cbc -K $encrypted_6e81ab708fb2_key -iv $encrypted_6e81ab708fb2_iv
  -in github_travis.enc -out /tmp/traviskey -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/traviskey
- ssh-add /tmp/traviskey

deploy:
- provider: script
  skip_cleanup: true
  script:
  - rsync -r --quiet --delete-after _site/* $DEPLOY_USER@$DEPLOY_HOST:$DEPLOY_DIRECTORY
  on:
    branch: master
- provider: script
  skip_cleanup: true
  script:
  - gem update --system && gem install bundler && bundle install --without :development :test && JEKYLL_ENV=stage bundle exec jekyll build --config _config.yml,_config-deploy-dev.yml && rsync -r --quiet
    --delete-after _site/* $DEPLOY_USER@$DEPLOY_HOST:$DEPLOY_DIRECTORY_DEV
  on:
    branch: develop
